"use strict";(()=>{var l={id:"default",match:()=>!0,detect:t=>{let{localStorageSnapshot:e}=t,o=e.username||e.user||e.account||"";return{state:o?"logged_in":"unknown",username:o||void 0,hint:o?`\u68C0\u6D4B\u5230\u672C\u5730\u5B58\u50A8\u7528\u6237\u540D\uFF1A${o}`:"\u672A\u68C0\u6D4B\u5230\u767B\u5F55\u4FE1\u606F\uFF08\u53EF\u5728\u89C4\u5219\u5F15\u64CE\u4E2D\u6269\u5C55\uFF09",detectedAt:new Date().toISOString()}}},g={id:"example.com",match:t=>t.endsWith("example.com"),detect:t=>{let e=t.document.querySelector("a[href*='login']"),o=t.document.querySelector("a[href*='logout'], a[href*='signout']"),r="unknown",n="\u793A\u4F8B\u89C4\u5219\uFF1A\u8BF7\u6839\u636E\u5B9E\u9645\u7AD9\u70B9\u7ED3\u6784\u8C03\u6574";return o?(r="logged_in",n="\u9875\u9762\u4E0A\u5B58\u5728\u9000\u51FA/\u767B\u51FA\u5165\u53E3"):e&&(r="logged_out",n="\u9875\u9762\u4E0A\u5B58\u5728\u767B\u5F55\u5165\u53E3"),{state:r,hint:n,detectedAt:new Date().toISOString()}}},f=[g,l];function p(t){let e=t.toLowerCase();for(let o of f)if(o.match(e))return o;return l}function s(t,e,o){return p(t).detect({hostname:t,document:e,localStorageSnapshot:o.localStorage})}function S(t){if(!t)return"\u672A\u547D\u540D\u7F51\u7AD9";let e=t.trim();if(!e)return"\u672A\u547D\u540D\u7F51\u7AD9";let o=[" - "," | "," _ "," \u2014 ","\uFF1A"];for(let r of o)if(e.includes(r)){let n=e.split(r);if(n[0]&&n[0].trim().length>0)return n[0].trim()}return e.length<=20?e:e.slice(0,20)+"..."}function d(t){let e=t.querySelectorAll("link[rel*='icon']");for(let o=0;o<e.length;o++){let r=e[o];if(r.href)return r.href}try{return new URL("/favicon.ico",t.location.origin).href}catch{return null}}function u(){let t=S(document.title),e=d(document);return{title:t,iconUrl:e}}function i(...t){console.log("[MultiAccount][cs]",...t)}function h(){let t={};try{for(let e=0;e<localStorage.length;e+=1){let o=localStorage.key(e);if(o)try{let r=localStorage.getItem(o);r!=null&&(t[o]=r)}catch{}}}catch(e){i("capture localStorage error",e)}return t}function m(t){try{localStorage.clear(),Object.entries(t).forEach(([e,o])=>{try{localStorage.setItem(e,o)}catch{}})}catch(e){throw i("apply localStorage error",e),e}}chrome.runtime.onMessage.addListener((t,e,o)=>{if(!(!t||typeof t.type!="string")){if(t.type==="PING"){o({ok:!0});return}if(t.type==="CAPTURE_PAGE_STATE"){try{let r=window.location.hostname,c={localStorage:h()};try{c.loginInfo=s(r,document,c)}catch(a){i("detect login state error",a)}try{c.siteInfo=u()}catch(a){i("extract site info error",a)}o(c)}catch(r){i("capture page state error",r),o(null)}return!0}if(t.type==="APPLY_PAGE_STATE"){try{let{localStorage:r}=t.payload;m(r),o({success:!0})}catch(r){o({success:!1,error:(r==null?void 0:r.message)||String(r)})}return!0}if(t.type==="DEBUG_LOG"){let{message:r,level:n}=t.payload,c="[MultiAccount][Popup]";return n==="error"?console.error(c,r):n==="warn"?console.warn(c,r):console.log(c,r),o({success:!0}),!0}}});i("content script loaded");})();
